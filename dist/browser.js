(()=>{let e=JSON.stringify;function t(e){if("function"==typeof crypto.randomUUID)var t=crypto.randomUUID();else{let e=e=>e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4;"undefined"==typeof crypto&&(e=e=>e^256*Math.random()&15>>e/4);var t="10000000-1000-4000-8000-100000000000".replace(/[018]/g,t=>e(t).toString(16))}return i(e,"id",t),t}globalThis.JSONTagTypeInfo||(globalThis.JSONTagTypeInfo=new WeakMap);let r=globalThis.JSONTagTypeInfo,n=e=>{if(r.has(e)){let t=r.get(e);if(t.type)return t.type}return Array.isArray(e)?"array":e instanceof Number?"number":e instanceof Boolean?"boolean":typeof e},a=["object","array","string","number","boolean","decimal","money","uuid","url","link","date","time","datetime","duration","timestamp","text","blob","color","email","hash","phone","int","int8","int16","int32","int64","uint","uint8","uint16","uint32","uint64","float","float32","float64"],o=(e,t)=>{if("object"!=typeof e)throw TypeError("JSONTag can only add attributes to objects, convert literals to objects first");let n={};if(r.has(e)&&(n=r.get(e)),!a.includes(t))throw TypeError("unknown type "+t);n.type=t,void 0===n.attributes&&(n.attributes={}),r.set(e,n)},i=(e,t,n)=>{if("object"!=typeof e)throw TypeError("JSONTag can only add attributes to objects, convert literals to objects first");if(Array.isArray(n)&&(n=n.join(" ")),"string"!=typeof n)throw TypeError("attribute values must be a string or an array of strings");if(-1!==n.indexOf('"'))throw TypeError('attribute values must not contain " character');-1!==n.indexOf(" ")&&(n=n.split(" "));let a=r.get(e)||{attributes:{}};a.attributes[t]=n,r.set(e,a)},s=(e,t)=>{if("object"!=typeof e)throw TypeError("JSONTag can only add attributes to objects, convert literals to objects first");if("object"!=typeof t)throw TypeError("attributes param must be an object");Object.keys(t).forEach(r=>{i(e,r,t[r])})},u=(e,t)=>(r.get(e)||{attributes:{}}).attributes[t],l=e=>Object.assign({},(r.get(e)||{attributes:{}}).attributes),c=e=>{let t=n(e),r=Object.entries(l(e)).map(([e,t])=>(Array.isArray(t)&&(t=t.join(" ")),e+'="'+t+'"')).join(" ");return(r||-1===["object","array","string","number","boolean"].indexOf(t)||(t=""),t||r)?"<"+[t,r].filter(Boolean).join(" ")+">":""};class f{constructor(){return new Proxy(this,{get:(e,t)=>{if(void 0!==e[t])return e[t];if("then"!=t&&"symbol"!=typeof t&&"toJSONTag"!=t)throw console.error("Attempting to get from Null",t,typeof t,JSON.stringify(t)),Error("Attempting to get "+t+" from Null")},set:(e,t,r)=>{throw console.error("Attempting to set "+t+" in Null to",r),Error("Attempting to set "+t+" in Null")}})}}class d extends f{isNull=!0;toString(){return""}toJSON(){return null}}class b{#e;constructor(e){if("string"!=typeof e)throw Error("not a url:",e);this.#e=""+e,o(this,"link")}static from(e){if(e instanceof b)return e;if("string"!=typeof e)throw Error("not a url:",e);return new b(e)}get value(){return this.#e}toString(){return this.#e}toJSON(){return this.#e}toJSONTag(){let e=new String(this.#e),t=l(this);return t&&s(e,t),o(e,"link"),e}}window.JSONTag={stringify:(r,a=null,i="")=>{let f=new WeakMap,d="",b="";if("number"==typeof i?d+=" ".repeat(i):"string"==typeof i&&(d=i),a&&"function"!=typeof a&&("object"!=typeof a||"number"!=typeof a.length))throw Error("JSONTag.stringify");let y=t=>{let r=b;b+=d;let n="",o="",i=Object.keys(t);Array.isArray(a)&&(i=i.filter(e=>-1!==a.indexOf(e))),b&&(n="\n"+b,o="\n"+r);let s=n+i.map(r=>void 0===t[r]?null:e(r)+":"+m(r,t)).filter(Boolean).join(","+n)+o;return b=r,s},p=e=>{let t=b,r="",n="";(b+=d)&&(r="\n"+b,n="\n"+t);let a=r+e.map((t,r)=>m(r,e)).join(","+r)+n;return b=t,a},g=new WeakMap,m=(r,d)=>{let b=d[r];if("function"==typeof a&&""!==r&&(b=a.call(d,r,b)),"object"===n(b)&&f.has(b)){let e=u(b,"id");return e||(e=t(b)),'<link>"'+e+'"'}if(null==b)return"null";if("object"===n(b)&&f.set(b,!0),"function"==typeof b.toJSONTag)b=b.toJSONTag();else if("function"==typeof b.toJSON){let e=n(b),t=l(b),r=b.toJSON();if("string"==typeof r)b=new String(r);else if("number"==typeof r)b=new Number(r);else{if(null==r)return null!==b?c(b)+"null":"null";b=r}t&&s(b,t),e&&o(b,e)}if(Array.isArray(b))return c(b)+"["+p(b)+"]";if(!(b instanceof Object))return e(b,a,i);switch(n(b)){case"string":case"decimal":case"money":case"link":case"text":case"blob":case"color":case"email":case"hash":case"duration":case"phone":case"url":case"uuid":case"date":case"time":case"datetime":return c(b)+e(""+b,a,i);case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float":case"float32":case"float64":case"timestamp":case"number":case"boolean":return c(b)+e(b,a,i);case"array":let g=p(b);return c(b)+"["+g+"}";case"object":if(null===b)return"null";let m=y(b);return c(b)+"{"+m+"}";default:throw Error(n(b)+" type not yet implemented")}};!function e(r){if(Array.isArray(r))for(let t of r)e(t);else if(r&&"object"==n(r)){if(g.has(r))u(r,"id")||t(r);else for(let t of(g.set(r,!0),Object.values(r)))e(t)}}(r);let h=m("",{"":r});return h},parse:function(e,t,r){let a,i,u,l;r||(r={}),r.index||(r.index={}),r.index.id||(r.index.id=new Map),r.unresolved||(r.unresolved=new Map),r.baseURL||(r.baseURL="http://localhost/");let c={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},f=function(t){let r=e.substring(a-100,a+100);throw{name:"SyntaxError",message:t,at:a,input:r}},b=function(t){return t&&t!==i&&f("Expected '"+t+"' instead of '"+i+"'"),i=e.charAt(a),a+=1,i},y=function(e){let t="";for("-"===i&&(t="-",b("-"));i>="0"&&i<="9";)t+=i,b();if("."===i)for(t+=".";b()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,b(),("-"===i||"+"===i)&&(t+=i,b());i>="0"&&i<="9";)t+=i,b();let r=new Number(t).valueOf();if(e)switch(e){case"int":h(t);break;case"uint":h(t,[0,1/0]);break;case"int8":h(t,[-128,127]);break;case"uint8":h(t,[0,255]);break;case"int16":h(t,[-32768,32767]);break;case"uint16":h(t,[0,65535]);break;case"int32":h(t,[-2147483648,2147483647]);break;case"uint32":h(t,[0,4294967295]);break;case"timestamp":case"int64":h(t,[-0x8000000000000000,0x7fffffffffffffff]);break;case"uint64":h(t,[0,18446744073709552e3]);break;case"float":m(t);break;case"float32":m(t,[-34e37,34e37]);break;case"float64":m(t,[-17e307,17e307]);break;case"number":break;default:p(e,t)}return r},p=function(e,t){f("Syntax error, expected "+e+", got: "+t)},g={color:/^(rgb|hsl)a?\((\d+%?(deg|rad|grad|turn)?[,\s]+){2,3}[\s\/]*[\d\.]+%?\)$/i,email:/^[A-Za-z0-9_!#$%&'*+\/=?`{|}~^.-]+@[A-Za-z0-9.-]+$/,uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,decimal:/^\d*\.?\d*$/,money:/^[A-Z]+\$\d*\.?\d*$/,duration:/^(-?)P(?=\d|T\d)(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)([DW]))?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+(?:\.\d+)?)S)?)?$/,phone:/^[+]?(?:\(\d+(?:\.\d+)?\)|\d+(?:\.\d+)?)(?:[ -]?(?:\(\d+(?:\.\d+)?\)|\d+(?:\.\d+)?))*(?:[ ]?(?:x|ext)\.?[ ]?\d{1,5})?$/,time:/^(\d{2}):(\d{2})(?::(\d{2}(?:\.\d+)?))?$/,date:/^-?[1-9][0-9]{3,}-([0][1-9]|[1][0-2])-([1-2][0-9]|[0][1-9]|[3][0-1])$/,datetime:/^(\d{4,})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2})(?::(\d{2}(?:\.\d+)?))?Z?$/,range:/^\[-?(\d+\.)?\d+\,-?(\d+\.)?\d+\]$/},m=function(e,t){let r=new Number(parseFloat(e)),n=r.toString();e!==n&&f("Syntax Error: expected float value"),t&&("number"==typeof t[0]&&r<t[0]&&f("Syntax Error: float value out of range"),"number"==typeof t[1]&&r>t[1]&&f("Syntax Error: float value out of range"))},h=function(e,t){let r=new Number(parseInt(e)),n=r.toString();e!==n&&f("Syntax Error: expected integer value"),t&&("number"==typeof t[0]&&r<t[0]&&f("Syntax Error: integer value out of range"),"number"==typeof t[1]&&r>t[1]&&f("Syntax Error: integer value out of range"))},x=function(e){let t=!1;return"#"===e.charAt(0)?(t=[3,4,6,8].indexOf((e=e.substring(1)).length)>-1&&!isNaN(parseInt(e,16))).toString(16)!==e&&p("color",e):t=g.color.test(e),t||p("color",e),!0},S=function(e){try{return new URL(e,r.baseURL),!0}catch(t){console.log(t),p("url",e)}},w=function(e,t){if(e){switch(e){case"object":case"array":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"int":case"uint":case"float32":case"float64":case"float":case"timestamp":p(e,t);break;case"uuid":return g.uuid.test(t)||p("uuid",t),!0;case"decimal":return g.decimal.test(t)||p("decimal",t),!0;case"money":return g.money.test(t)||p("money",t),!0;case"url":return S(t);case"link":case"string":case"text":case"blob":case"hash":return!0;case"color":return x(t);case"email":return g.email.test(t)||p("email",t),!0;case"duration":return g.duration.test(t)||p("duration",t),!0;case"phone":return g.phone.test(t)||p("phone",t),!0;case"range":return g.range.test(t)||p("range",t),!0;case"time":return g.time.test(t)||p("time",t),!0;case"date":return g.date.test(t)||p("date",t),!0;case"datetime":return g.datetime.test(t)||p("datetime",t),!0}f("Syntax error: unknown tagName "+e)}},k=function(e){let t="",r,n,a;for('"'!==i&&f("Syntax Error"),b('"');i;){if('"'===i)return b(),w(e,t),t;if("\\"===i){if(b(),"u"===i){for(n=0,a=0;n<4&&isFinite(r=parseInt(b(),16));n++)a=16*a+r;t+=String.fromCharCode(a),b()}else if("string"==typeof c[i])t+=c[i],b();else break}else t+=i,b()}f("Syntax error: incomplete string")},v=function(){let e,t,r={attributes:{}};for("<"!==i&&f("Syntax Error"),b("<"),(e=N())||f("Syntax Error: expected tag name"),r.tagName=e,A();i;){if(">"===i)return b(">"),r;(e=N())||f("Syntax Error: expected attribute name"),A(),b("="),A(),t=k(),r.attributes[e]=t,A()}f("Syntax Error: unexpected end of input")},A=function(){for(;i;)switch(i){case" ":case"	":case"\r":case"\n":b();break;default:return}},N=function(){let e="";for(i>="a"&&i<="z"||i>="A"&&i<="Z"?(e+=i,b()):f("Syntax Error: expected word");i>="a"&&i<="z"||i>="A"&&i<="Z"||i>="0"&&i<="9"||"_"==i;)e+=i,b();return e},j=function(e){let t=N();switch(t&&"string"==typeof t||f('Syntax error: expected boolean or null, got "'+t+'"'),t.toLowerCase()){case"true":return e&&"boolean"!==e&&p(e,t),!0;case"false":return e&&"boolean"!==e&&p(e,t),!1;case"null":return null;default:f('Syntax error: expected boolean or null, got "'+t+'"')}},E=function(e,t,a){if("link"===n(e)){let n=""+e,o=r.unresolved.get(n);void 0===o&&(r.unresolved.set(n,[]),o=r.unresolved.get(n)),o.push({src:new WeakRef(t),key:a})}},O=function(){let e,t=[];if("["!==i&&f("Syntax error"),b("["),A(),"]"===i)return b("]"),t;for(;i;){if(e=u(),E(e,t,t.length),t.push(e),A(),"]"===i)return b("]"),t;b(","),A()}f("Input stopped early")},T=function(){let e,t,r={};if("{"!==i&&f("Syntax Error"),b("{"),A(),"}"===i)return b("}"),r;for(;i;){if("__proto__"===(e=k())&&f("Attempt at prototype pollution"),A(),b(":"),t=u(),r[e]=t,E(t,r,e),A(),"}"===i)return b("}"),r;b(","),A()}f("Input stopped early")};u=function(){let e,t,n;switch(A(),"<"===i&&(n=(e=v()).tagName,A()),i){case"{":n&&"object"!==n&&p(n,i),t=T();break;case"[":n&&"array"!==n&&p(n,i),t=O();break;case'"':t=k(n);break;case"-":t=y(n);break;default:t=i>="0"&&i<="9"?y(n):j(n)}if(e){if(null===t&&(t=new d),"object"!=typeof t)switch(typeof t){case"string":t=new String(t);break;case"number":t=new Number(t);break;default:f("Syntax Error: unexpected type "+typeof t)}e.tagName&&o(t,e.tagName),e.attributes&&(s(t,e.attributes),e.attributes?.id&&r.index.id.set(e.attributes.id,new WeakRef(t)))}return t},a=0,i=" ",l=u(),A(),i&&f("Syntax error"),"function"==typeof t&&function e(a,o){var i,s,u=a[o];if(null!==u&&"object"==typeof u&&!(u instanceof String||u instanceof Number||u instanceof Boolean))for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(void 0!==(s=e(u,i))&&(void 0===u[i]||u[i]!==s)?(u[i]=s,"link"===n(s)&&E(s,u,i)):void 0===s&&delete u[i]);return t.call(a,o,u,r)}({"":l},"");let J=function(e,t){if(void 0!==t){let r=e.src.deref();if(void 0!==r&&"link"===n(r[e.key]))return r[e.key]=t,!0}};return r.index.id.size>r.unresolved.size?r.unresolved.forEach((e,t)=>{let n=r.index.id.get(t)?.deref();void 0!==n&&e.forEach((t,r)=>{J(t,n)&&delete e[r]})}):r.index.id.forEach((e,t)=>{let n=e.deref(),a=r.unresolved.get(t);void 0!==n&&void 0!==a&&(a.forEach((e,t)=>{J(e,n)}),r.unresolved.delete(t))}),l},getType:n,setType:o,getTypeString:c,setAttribute:i,getAttribute:u,addAttribute:(e,t,n)=>{if("string"!=typeof n)throw TypeError("attribute values must be a string");if(-1!==n.indexOf('"'))throw TypeError('attribute values must not contain " characters');let a=r.get(e)||{attributes:{}};void 0===a.attributes[t]?i(e,t,n):(Array.isArray(a.attributes[t])||(a.attributes[t]=[a.attributes[t]]),n=-1!==n.indexOf(" ")?n.split(" "):[n],a.attributes[t]=a.attributes[t].concat(n),r.set(e,a))},removeAttribute:(e,t)=>{let n=r.get(e)||{attributes:{}};void 0!==n.attributes[t]&&(delete n.attributes[t],r.set(e,n))},getAttributes:l,setAttributes:s,getAttributesString:e=>Object.entries(l(e)).map(([e,t])=>(Array.isArray(t)&&(t=t.join(" ")),e+'="'+t+'"')).join(" "),isNull:e=>null===e||void 0!==e.isNull&&e.isNull,clone:e=>{let t=c(e),r=n(e),a=l(e),i=function(e){return e instanceof Number?new Number(e):e instanceof Boolean?new Boolean(e):e instanceof String?new String(e):Array.isArray(e)?[...e]:{...e}}(e);return t&&(o(i,r),a&&s(i,a)),i},Link:b,Null:d}})();
//# sourceMappingURL=browser.js.map
